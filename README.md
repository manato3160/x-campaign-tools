# Xアカウント AI自動抽選ツール - Google Colab版

Xアカウントの抽選を抽選定義に基づいてAI（Grok）が自動判定するGoogle Colabノートブックです。最大30,000件のアカウントを処理可能です。

## 機能

- **自動抽選判定**: Grok APIを使用してアカウントの抽選可否を自動判定
- **大量データ対応**: バッチ処理により30,000件以上のアカウントを処理可能
- **詳細な判定基準**: 懸賞アカウント、美容アカウント、その他懸念などを自動判定
- **結果出力**: CSV形式で結果を出力（Excel対応）
- **Google Drive連携**: CSVファイルのアップロード/ダウンロードに対応
- **ローカル環境不要**: ブラウザから直接実行可能

## 技術スタック

- Python 3.10以上（Google Colab環境）
- xai-sdk 1.3.1以上（Grok API、X検索ツール対応）
- pydantic（構造化出力）
- pandas（データ処理）

## セットアップ

### 1. Google Colabでノートブックを開く

1. [Google Colab](https://colab.research.google.com/)にアクセス
2. 「ファイル」→「ノートブックをアップロード」を選択
3. `Xキャンペーン自動抽選_GoogleColab.ipynb`をアップロード

または、Google Driveにノートブックを保存して、右クリック→「アプリで開く」→「Colaboratory」を選択

### 2. XAI_API_KEYの設定

[xAI Console](https://console.x.ai/)でAPIキーを取得し、ノートブック内の「環境変数の設定」セルで設定してください。

**重要**: APIキーは`getpass`を使用して入力するため、画面に表示されません。

### 3. CSVファイルのアップロード

ノートブック内の「CSVファイルのアップロード」セルで、処理するCSVファイルをアップロードしてください。

## 使用方法

詳細な使用方法は[GOOGLE_COLAB_GUIDE.md](./GOOGLE_COLAB_GUIDE.md)を参照してください。

### 基本的な使い方

1. ノートブックを開く
2. セルを順番に実行する
3. XAI_API_KEYを設定する
4. CSVファイルをアップロードする
5. 抽選処理を実行する
6. 結果をダウンロードする

### 処理設定

ノートブック内の「抽選処理の実行」セルで、以下のパラメータを設定できます：

```python
LIMIT = None  # テスト用: 10件のみ処理する場合は 10 を設定
WORKERS = 50  # 並列処理のワーカー数
CHUNK_SIZE = 200  # 1チャンクあたりの処理件数
CAMPAIGN_KEYWORD = ""  # キャンペーンキーワード（オプション）
```

**推奨設定**:
- **テスト実行**: `LIMIT = 10`, `WORKERS = 20`
- **本番実行**: `LIMIT = None`, `WORKERS = 50`, `CHUNK_SIZE = 200`

## 入力CSV形式

入力CSVファイルは以下の2つの形式に対応しています：

### 形式1: 旧形式（handle列）

`handle`列を含むCSVファイル：

```csv
handle
user1
@user2
user3
```

### 形式2: 新形式（ユーザーIDとURL列）

A列にユーザーID、B列にプロフィールURLが記載されたCSVファイル（4行目以降からデータ開始）：

```csv
（1-3行目: 任意のヘッダー情報）
ユーザーID,URL,フォロー数,フォロワー数,...
takachandayo,https://x.com/takachandayo,...
1RzyuS40vr,https://x.com/1RzyuS40vr,...
```

**注意**:
- ヘッダー行は自動検出されます（「ユーザーID」または「URL」を含む行）
- URLからハンドル名を自動抽出します（例: `https://x.com/takachandayo` → `takachandayo`）
- URLが抽出できない場合、ユーザーID列の値を使用します
- `@`マークは自動的に削除されます

## 出力CSV形式

出力CSVファイルは以下の列を含みます：

- `handle`: Xハンドル
- `is_eligible`: 当選可/排除
- `is_prize_account`: 懸賞アカウント（○ or 空白）
- `is_beauty_account`: 美容アカウント（○ or 空白）
- `is_other_concern`: その他懸念（○ or 空白）
- `is_teenager`: 10代学生（○ or 空白）
- `is_male`: 明らかな男性（○ or 空白）
- `is_female`: 明らかな女性（○ or 空白）
- `final_reason`: 最終判定理由
- `profile_summary`: プロフィール概要
- `analysis_date`: 分析日時

## 抽選判定ルール

抽選判定は`★抽選定義★ - 抽選定義.csv`ファイルに基づいて行われます。このファイルには以下の判定基準が詳細に記載されています：

### 主な判定基準

1. **懸賞アカウント排除**
   - プロフィールに「懸賞」「当選」の記載がある
   - 直近10投稿すべてが懸賞系投稿・リポスト
   - ピン留め投稿が懸賞系

2. **美容アカウント排除**
   - コスメ投稿をしている（モニター・PR系はOK）

3. **その他懸念排除**
   - 公序良俗違反、過激投稿、ネガティブ投稿など

4. **10代学生排除**
   - プロフィールor投稿に学校関連記載

5. **性別判定**
   - 明らかな男性/女性を判定

**重要**: 抽選定義CSVファイルが存在しない場合、デフォルトの判定ルールが使用されます。判定ルールを変更する場合は、`★抽選定義★ - 抽選定義.csv`ファイルを編集してください。

## 処理時間の目安

**処理時間の目安（10,000件）**:
- デフォルト設定（50ワーカー、200件チャンク）: **約1時間**
- 高速設定（100ワーカー、500件チャンク）: **約30-45分**
- 保守的設定（20ワーカー、100件チャンク）: **約2-3時間**

**注意**: 
- ワーカー数を増やすと処理速度は向上しますが、APIレート制限に達する可能性があります
- デフォルトは50ワーカー、200件ずつのチャンク処理です（1時間で10,000件処理を目指す設定）
- APIレート制限エラーが発生した場合は、`WORKERS`を減らしてください

## トラブルシューティング

詳細なトラブルシューティングは[GOOGLE_COLAB_GUIDE.md](./GOOGLE_COLAB_GUIDE.md)を参照してください。

### APIキーエラー

- XAI_API_KEYが正しく設定されているか確認してください
- [xAI Console](https://console.x.ai/)でAPIキーが有効か確認してください

### CSV読み込みエラー

- CSVファイルがUTF-8エンコードであることを確認してください
- ファイル形式が正しいか確認してください（旧形式または新形式）

### APIレート制限エラー

- `WORKERS`の値を減らしてください（例: 50 → 20）
- しばらく待ってから再実行してください

### メモリ不足エラー

- `CHUNK_SIZE`を小さくしてください（例: 200 → 100）
- `LIMIT`を設定して処理件数を制限してください

## メリット

- **ローカル環境不要**: ブラウザから直接実行可能
- **無料で利用可能**: Google Colabの無料プランで利用可能
- **どこからでもアクセス**: ブラウザがあれば実行可能
- **Google Drive連携**: CSVファイルの管理が簡単
- **高性能リソース**: Colabの無料GPU/TPUリソースを活用可能

## セキュリティに関する注意事項

1. **APIキーの管理**:
   - APIキーは`getpass`を使用して入力してください
   - ノートブックを共有する前に、APIキーが含まれていないことを確認してください
   - 不要になったAPIキーは無効化してください

2. **データの取り扱い**:
   - 個人情報を含むCSVファイルの取り扱いに注意してください
   - Google Driveに保存する場合は、適切な共有設定を行ってください

3. **セッション管理**:
   - 処理完了後は、セッションを終了してください
   - ノートブックを共有する場合は、機密情報が含まれていないことを確認してください

## 参考資料

- [GOOGLE_COLAB_GUIDE.md](./GOOGLE_COLAB_GUIDE.md) - 詳細な使い方ガイド
- [xAI Console](https://console.x.ai/) - APIキーの取得
- [xAI Python SDK GitHub](https://github.com/xai-org/xai-sdk-python)
- [xAI Documentation](https://docs.x.ai)
- [xAI Search Tools Guide](https://docs.x.ai/docs/guides/tools/search-tools)

## ライセンス

このプロジェクトは内部使用を目的としています。
